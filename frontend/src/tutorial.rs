use fsm::fsm::StateMachine;
use yew::prelude::*;
use yew_bootstrap::component::Container;

use crate::{canvas::Canvas, canvas_player::CanvasPlayer};

// {"nodes":[{"x":131,"y":98,"text":"","isAcceptState":false},{"x":189,"y":172,"text":"","isAcceptState":false},{"x":374,"y":98,"text":"","isAcceptState":false},{"x":627,"y":98,"text":"","isAcceptState":false},{"x":690,"y":172,"text":"","isAcceptState":false},{"x":437,"y":172,"text":"","isAcceptState":false},{"x":131,"y":293,"text":"","isAcceptState":false},{"x":131,"y":458,"text":"","isAcceptState":false},{"x":189,"y":528,"text":"","isAcceptState":false},{"x":189,"y":357,"text":"","isAcceptState":false},{"x":374,"y":293,"text":"","isAcceptState":false},{"x":627,"y":293,"text":"","isAcceptState":false},{"x":437,"y":357,"text":"","isAcceptState":false},{"x":690,"y":357,"text":"","isAcceptState":false},{"x":374,"y":458,"text":"","isAcceptState":false},{"x":437,"y":528,"text":"","isAcceptState":false},{"x":627,"y":458,"text":"","isAcceptState":false},{"x":690,"y":528,"text":"","isAcceptState":false}],"links":[{"type":"Link","nodeA":0,"nodeB":2,"text":"1","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":2,"nodeB":3,"text":"1","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":0,"nodeB":1,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5470588235294116,"perpendicularPart":36.50237703782816},{"type":"Link","nodeA":1,"nodeB":0,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.595022624434389,"perpendicularPart":0.0},{"type":"Link","nodeA":2,"nodeB":5,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.40158814187400743,"perpendicularPart":26.660385928787488},{"type":"Link","nodeA":5,"nodeB":2,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":3,"nodeB":4,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.46077289571201696,"perpendicularPart":27.61731988918009},{"type":"Link","nodeA":4,"nodeB":3,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":6,"nodeB":9,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5160857908847185,"perpendicularPart":28.250127523496843},{"type":"Link","nodeA":9,"nodeB":6,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5576407506702413,"perpendicularPart":0.0},{"type":"Link","nodeA":10,"nodeB":12,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.47451952882827025,"perpendicularPart":23.706829462714104},{"type":"Link","nodeA":12,"nodeB":10,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":11,"nodeB":13,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.611764705882353,"perpendicularPart":22.343837155321587},{"type":"Link","nodeA":13,"nodeB":11,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":7,"nodeB":8,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.531703775411423,"perpendicularPart":23.16664867524449},{"type":"Link","nodeA":8,"nodeB":7,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":14,"nodeB":15,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.6748224151539068,"perpendicularPart":23.562424436035172},{"type":"Link","nodeA":15,"nodeB":14,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":16,"nodeB":17,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5895816890292028,"perpendicularPart":32.481954191001165},{"type":"Link","nodeA":17,"nodeB":16,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":6,"nodeB":10,"text":"1","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":10,"nodeB":11,"text":"1","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":7,"nodeB":14,"text":"1","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":14,"nodeB":16,"text":"1","lineAngleAdjust":0.0,"parallelPart":0.5,"perpendicularPart":0.0},{"type":"Link","nodeA":17,"nodeB":15,"text":"2","lineAngleAdjust":3.141592653589793,"parallelPart":0.5612648221343873,"perpendicularPart":-29.0},{"type":"Link","nodeA":15,"nodeB":8,"text":"2","lineAngleAdjust":3.141592653589793,"parallelPart":0.2903225806451613,"perpendicularPart":-25.0},{"type":"Link","nodeA":13,"nodeB":12,"text":"2","lineAngleAdjust":3.141592653589793,"parallelPart":0.5019762845849802,"perpendicularPart":-29.0},{"type":"Link","nodeA":12,"nodeB":9,"text":"2","lineAngleAdjust":3.141592653589793,"parallelPart":0.5040322580645161,"perpendicularPart":-31.0},{"type":"Link","nodeA":4,"nodeB":5,"text":"2","lineAngleAdjust":3.141592653589793,"parallelPart":0.6837944664031621,"perpendicularPart":-23.0},{"type":"Link","nodeA":5,"nodeB":1,"text":"2","lineAngleAdjust":3.141592653589793,"parallelPart":0.5040322580645161,"perpendicularPart":-23.0},{"type":"Link","nodeA":0,"nodeB":6,"text":"3","lineAngleAdjust":0.0,"parallelPart":0.7487179487179487,"perpendicularPart":28.0},{"type":"Link","nodeA":10,"nodeB":14,"text":"3","lineAngleAdjust":0.0,"parallelPart":0.6424242424242425,"perpendicularPart":21.0},{"type":"Link","nodeA":16,"nodeB":3,"text":"3","lineAngleAdjust":0.0,"parallelPart":0.14444444444444443,"perpendicularPart":86.0}]}

fn get_sample_fsm() -> StateMachine {
    serde_json::from_str(r#"{"nodes":[{"x":145,"y":207,"text":"","isAcceptState":true},{"x":145,"y":448,"text":"","isAcceptState":false},{"x":512,"y":448,"text":"","isAcceptState":true},{"x":512,"y":207,"text":"","isAcceptState":false}],"links":[{"type":"StartLink","node":0,"text":"","deltaX":-76,"deltaY":-105},{"type":"Link","nodeA":0,"nodeB":3,"text":"1","lineAngleAdjust":3.141592653589793,"parallelPart":0.5258855585831063,"perpendicularPart":-36.0},{"type":"Link","nodeA":3,"nodeB":0,"text":"1","lineAngleAdjust":3.141592653589793,"parallelPart":0.5858310626702997,"perpendicularPart":-29.0},{"type":"Link","nodeA":1,"nodeB":2,"text":"1","lineAngleAdjust":3.141592653589793,"parallelPart":0.7329700272479565,"perpendicularPart":-27.0},{"type":"Link","nodeA":2,"nodeB":1,"text":"1","lineAngleAdjust":3.141592653589793,"parallelPart":0.6158038147138964,"perpendicularPart":-42.0},{"type":"Link","nodeA":0,"nodeB":1,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.6763485477178424,"perpendicularPart":31.0},{"type":"Link","nodeA":1,"nodeB":0,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.5062240663900415,"perpendicularPart":31.0},{"type":"Link","nodeA":3,"nodeB":2,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.7427385892116183,"perpendicularPart":25.0},{"type":"Link","nodeA":2,"nodeB":3,"text":"0","lineAngleAdjust":0.0,"parallelPart":0.6929460580912863,"perpendicularPart":23.0}]}"#).unwrap()
}

#[function_component(Tutorial)]
pub fn tutorial() -> Html {
    html!(
        <>
            <nav class="navbar bg-body-tertiary">
                <div class="container-fluid">
                    <a href="/" classes="navbar-brand">{"RUDN FSM tutorial"}</a>
                    // <div class="nav-item">
                    //     <Link<Route> classes="nav-link" to={Route::Editor}>{"Редактор автоматов"}</Link<Route>>
                    // </div>
                    // <div class="nav-item">
                    //     <Link<Route> classes="nav-link" to={Route::Scripter}>{"Отладка заданий"}</Link<Route>>
                    // </div>
                    // <ProfileNav />
                </div>
            </nav>
            <Container>
                    <CanvasPlayer word="10101010" fsm={get_sample_fsm()} />
            </Container>
        </>
    )
}
